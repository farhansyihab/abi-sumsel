version: '3.8'

services:
  # Service untuk aplikasi Wagtail Anda
  web:
    build: .
    container_name: wagtail_app
    # Mount direktori proyek untuk development (hot-reload)
    volumes:
      - .:/app
      # Gunakan volume untuk Python bytecode cache jika perlu
      - /app/__pycache__
    ports:
      - "8000:8000"
    # Service TIDAK bergantung pada container database lokal
    # depends_on: [db] <-- KOMENTAR INI SAJA KARENA DB EKSTERNAL
    env_file:
      - .env.dev
    # Perintah untuk development server
    command: python manage.py runserver 0.0.0.0:8000
    # Environment khusus untuk dev, bisa di-override
    environment:
      - DEBUG=True
      - DJANGO_SETTINGS_MODULE=mysite.settings.dev
    # Restart hanya jika berhenti dengan code error
    restart: "unless-stopped"

  # Service database opsional (HANYA untuk development jika Anda butuh PostgreSQL lokal)
  # db:
  #   image: postgres:15-alpine
  #   container_name: wagtail_db_local
  #   env_file:
  #     - .env.dev.db  # File env untuk pengaturan lokal
  #   volumes:
  #     - postgres_local_data:/var/lib/postgresql/data
  #   ports:
  #     - "5433:5432"  # Gunakan port berbeda agar tidak konflik dengan PostgreSQL lokal/supabase
  #   restart: "always"

# Definisikan volume jika Anda aktifkan service db lokal
#volumes:
#  postgres_local_data: