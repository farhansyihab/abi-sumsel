{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags static %}

{% block title %}DPW ABI Sumatera Selatan - Beranda{% endblock %}

{% block content %}
<!-- ======= Hero Section ======= -->
<section id="hero" class="hero" style="padding-top: 15px !important; margin: auto; max-width: max-content;">
    <div class="container position-relative" style="background-color: white !important;">
        <div class="row gy-5">
            
        <!-- ======= Google Calendar (Daftar Acara) ======= -->
            <div class="col-12 col-lg-3 order-3 order-lg-3">
                <div class="row justify-content-center">
                <div class="col-lg-10">
                    <div class="card shadow-sm border-1 rounded-3">
                      <div class="card-header text-white text-center py-2" style="background-color: #008375;">
                          <h6 class="mb-0"><i class="bi bi-calendar-event me-2"></i>Kalender Kegiatan</h6>
                      </div>
                      <a href="jadwal-acara/" class="text-decoration-none text-dark">
                        <div class="card-body">
                            <div id="events-list">
                            <p class="text-center"><i class="bi bi-hourglass"></i> Memuat agenda...</p>
                            </div>
                        </div>                        
                      </a>
                    </div>
                </div>
                </div>
            </div>

            <!-- Rest of your hero content -->
            <div class="col-12 col-lg-3 order-2 order-lg-1 align-items-center" style="max-width: fit-content; margin: auto;">
                <div class="row" style="font-size: 30px; padding-top: 40px;"><strong>DPW <span>ABI SUMSEL</span></strong></div>
                <div class="row"><p>{{ page.hero_subtitle|default:"Sinergi khidmad untuk bangsa yang bermartabat" }}</p></div>
            </div>

            <div class="col-12 col-lg-6 order-1 order-lg-2 d-flex justify-content-center">
                {% if page.hero_image %}
                    {% image page.hero_image fill-600x400 class="img-fluid" alt="ABI SUMSEL" %}
                {% else %}
                    <img src="https://lh3.googleusercontent.com/pw/AP1GczNsLgGeCiC08i7LP4e5pQAfrMf4ugNWdCP3GqtinhzW_gV0r-QwFgkULGAISDVuOl19A0lIn5eqpX3QO8c3TKBo_4dGoivic78OgFUI9HOQXTjJapx6Cx8noUStCQywAS3IedCxdF7iAG9m4w8AaGW_=w1304-h594-s-no?authuser=0" class="img-fluid" alt="ABI SUMSEL" style="height: fit-content !important;">
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Icon boxes section... -->
    <div class="icon-boxes position-relative">
      <div class="container position-relative">
        <div class="row gy-4 mt-5">

          <div class="col-xl-3 col-md-6" data-aos="fade-up" data-aos-delay="100">
            <div class="icon-box">
              <div class="icon"><i class="bi bi-easel"></i></div>
              <h4 class="title"><a href="/about" class="stretched-link">Tentang ABI</a></h4>
            </div>
          </div><!--End Icon Box -->

          <div class="col-xl-3 col-md-6" data-aos="fade-up" data-aos-delay="200">
            <div class="icon-box">
              <div class="icon"><i class="bi bi-microsoft-teams"></i></div>
              <h4 class="title"><a href="/team" class="stretched-link">Struktur Organisasi</a></h4>
            </div>
          </div><!--End Icon Box -->

          <div class="col-xl-3 col-md-6" data-aos="fade-up" data-aos-delay="300">
            <div class="icon-box">
              <div class="icon"><i class="bi bi-info-lg"></i></div>
              <h4 class="title"><a href="/info" class="stretched-link">Info ABI SUMSEL</a></h4>
            </div>
          </div><!--End Icon Box -->

          <div class="col-xl-3 col-md-6" data-aos="fade-up" data-aos-delay="500">
            <div class="icon-box">
              <div class="icon"><i class="bi bi-whatsapp"></i></div>
              <h4 class="title"><a href="/contact" class="stretched-link">Hubungi Kami</a></h4>
            </div>
          </div><!--End Icon Box -->

        </div>
      </div>
    </div>  
    <!--End Icon Box section -->   
</section>
{% endblock %}

{% block extra_js %}

<script>
  // ⚠️ GANTI DENGAN NILAI ANDA
  const API_KEY = 'AIzaSyATHg3LO4Im6DnQIvorYCVW0cmvhIZpfmA'; // ← GANTI DENGAN API KEY ANDA
  const CALENDAR_ID = 'd2684a340253715322e8696d20297847b0bc0a21155b50bcc9a89e63a371dae1@group.calendar.google.com';

  // Ambil acara 30 hari ke depan (opsional: sesuaikan)
  const now = new Date();
  const timeMin = now.toISOString();
  const timeMax = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000).toISOString();

  fetch(`https://www.googleapis.com/calendar/v3/calendars/${CALENDAR_ID}/events?key=${API_KEY}&orderBy=startTime&singleEvents=true&timeMin=${encodeURIComponent(timeMin)}&timeMax=${encodeURIComponent(timeMax)}&maxResults=10`)
    .then(res => {
      if (!res.ok) throw new Error('Gagal mengambil data');
      return res.json();
    })
    .then(data => {
      const container = document.getElementById('events-list');
      if (!data.items || data.items.length === 0) {
        container.innerHTML = '<p class="text-center text-muted">Tidak ada agenda dalam 30 hari ke depan.</p>';
        return;
      }
      const eventsToShow = data.items.slice(0, 2);
      container.innerHTML = eventsToShow.map(event => {
        const start = new Date(event.start.dateTime || event.start.date);
        const end = event.end?.dateTime ? new Date(event.end.dateTime) : null;

        // Format tanggal
        const formattedDate = start.toLocaleDateString('id-ID', {
          weekday: 'long', day: 'numeric', month: 'long', year: 'numeric'
        });

        // Format waktu
        let timeStr = '';
        if (event.start.dateTime) {
          const startTime = start.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
          const endTime = end ? end.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }) : '';
          timeStr = ` · ${startTime}–${endTime}`;
        } else {
          timeStr = ' · Sepanjang hari';
        }

        return `
          <div class="card mb-3">
            <div class="card-body">
              <h6 class="card-title mb-1">${event.summary || 'Acara Tanpa Judul'}</h6>
              <p class="text-muted small mb-1">
                <i class="bi bi-calendar2-event me-1"></i> ${formattedDate}
              </p>
            </div>
          </div>
        `;
      }).join('');
    })
    .catch(err => {
      console.error('Error fetching calendar events:', err);
      document.getElementById('events-list').innerHTML = '<p class="text-center text-danger">Gagal memuat agenda.</p>';
    });
</script>

{% endblock %}
