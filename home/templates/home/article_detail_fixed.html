<!-- home/templates/home/article_detail_final.html -->
{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags static %}

{% block meta_tags %}
    <!-- Basic Meta Tags -->
    <meta property="og:url" content="{{ request.build_absolute_uri }}">
    <meta property="og:type" content="article">
    <meta property="og:title" content="{{ page.get_meta_title }}">
    <meta property="og:description" content="{{ page.get_meta_description }}">

    <!-- Fix untuk og:image -->
    {% if meta_og_image_url %}
        <!-- Jika ada URL gambar OG dari model -->
        <meta property="og:image" content="{{ meta_og_image_url }}">
    {% elif page.featured_image %}
        <!-- Fallback ke featured_image jika ada -->
        {% image page.featured_image fill-1200x630 as og_image %}
        <meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{{ og_image.url }}">
    {% else %}
        <!-- Default logo jika tidak ada gambar sama sekali -->
        <meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{% static 'img/logoabi.png' %}">
    {% endif %}
    
    {% if meta_og_image_url or page.featured_image %}
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    {% endif %}  
    
    <meta property="og:site_name" content="DPW ABI Sumatera Selatan">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ page.get_meta_title }}">
    <meta name="twitter:description" content="{{ page.get_meta_description }}">
    
    <!-- Article Specific -->
    {% if page.date_published %}
    <meta property="article:published_time" content="{{ page.date_published|date:'c' }}">
    {% endif %}
    {% if page.category %}
    <meta property="article:section" content="{{ page.category.name }}">
    {% endif %}
{% endblock %}

{% block title %}{{ page.get_meta_title }} | DPW ABI SUMSEL{% endblock %}

{% block content %}
<div class="container mt-4">
    <article class="article-detail">
        <!-- Header -->
        <header class="article-header mb-4">
            {% if page.category %}
            <div class="article-category mb-2">
                <span class="badge bg-primary">{{ page.category.name }}</span>
            </div>
            {% endif %}
            
            <!-- <h1 class="article-title display-4">{{ page.title }}</h1>
            
            {% if page.excerpt %}
            <p class="article-excerpt lead text-muted">{{ page.excerpt }}</p>
            {% endif %} -->
            
            <div class="article-meta text-muted small">
                {% if page.date_published %}
                <span class="me-3">
                    <i class="bi bi-calendar"></i>
                    {{ page.date_published|date:"d F Y" }}
                </span>
                {% endif %}
                
                {% if page.owner %}
                <span>
                    <i class="bi bi-person"></i>
                    {{ page.owner.get_full_name|default:page.owner.username }}
                </span>
                {% endif %}
            </div>
        </header>
        
        <!-- Featured Image -->
        {% if page.featured_image %}
        <div class="article-featured-image mb-4">
            {% image page.featured_image width-1200 class="img-fluid rounded shadow" %}
            {% if page.featured_image.caption %}
            <p class="text-center text-muted mt-2 small">{{ page.featured_image.caption }}</p>
            {% endif %}
        </div>
        {% endif %}
        
        <!-- Article Content -->
        <div class="article-body">
            {% for block in page.body %}
                <section class="article-block block-{{ block.block_type }} mb-4">
                    {% include_block block %}
                </section>
            {% empty %}
                <div class="alert alert-info">
                    <i class="bi bi-info-circle"></i> Konten artikel sedang dalam proses penulisan.
                </div>
            {% endfor %}
        </div>
        
        <!-- Article Footer -->
        <footer class="article-footer mt-5 pt-4 border-top">
            <!-- Share buttons -->
            <div class="share-buttons mb-4">
                <h5 class="mb-3">Bagikan artikel ini:</h5>
                <div class="btn-group" role="group">
                    <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri|urlencode }}" 
                       target="_blank" class="btn btn-outline-primary btn-sm">
                        <i class="bi bi-facebook"></i> Facebook
                    </a>
                    <a href="https://twitter.com/intent/tweet?text={{ page.title|urlencode }}&url={{ request.build_absolute_uri|urlencode }}" 
                       target="_blank" class="btn btn-outline-info btn-sm">
                        <i class="bi bi-twitter"></i> Twitter
                    </a>
                    <a href="https://wa.me/?text={{ page.title|urlencode }}%20{{ request.build_absolute_uri|urlencode }}" 
                       target="_blank" class="btn btn-outline-success btn-sm">
                        <i class="bi bi-whatsapp"></i> WhatsApp
                    </a>
                </div>
            </div>
            
            <!-- Related Articles -->
            {% if latest_articles %}
            <div class="related-articles">
                <h5 class="mb-3">Artikel Terkait:</h5>
                <div class="row">
                    {% for related in latest_articles|slice:":3" %}
                    <div class="col-md-4 mb-3">
                        <div class="card h-100">
                            {% if related.featured_image %}
                            {% image related.featured_image fill-300x200 class="card-img-top" %}
                            {% endif %}
                            <div class="card-body">
                                <h6 class="card-title">
                                    <a href="{% pageurl related %}" class="text-decoration-none">
                                        {{ related.title }}
                                    </a>
                                </h6>
                                <small class="text-muted">
                                    {{ related.date_published|date:"d M Y"|default:"" }}
                                </small>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </footer>
    </article>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .article-detail {
        line-height: 1.8;
        font-size: 1.1rem;
    }
    
    .article-title {
        color: #2c3e50;
        font-weight: 700;
        margin-bottom: 1rem;
    }
    
    .article-excerpt {
        font-size: 1.25rem;
        color: #7f8c8d;
    }
    
    .article-body img {
        max-width: 100%;
        height: auto;
    }
    
    .article-body p {
        margin-bottom: 1.5rem;
    }
    
    .article-body h2 {
        margin-top: 2rem;
        margin-bottom: 1rem;
        color: #2c3e50;
    }
    
    .article-body h3 {
        margin-top: 1.5rem;
        margin-bottom: 1rem;
    }
    
    .block-paragraph {
        font-family: 'Georgia', serif;
    }
</style>
{% endblock %}